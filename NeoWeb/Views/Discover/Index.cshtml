@model IEnumerable<NeoWeb.Models.DiscoverViewModel>
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer

@{
    ViewData["Title"] = "Discover";
}

@section Styles{
    <environment include="Development">
        <link rel="stylesheet" href="/css/discover.css" asp-append-version="true" />
    </environment>
    <environment exclude="Development">
        <link rel="stylesheet" href="@Helper.ToCDN("/css/discover.min.css", true)" />
    </environment>
    <style>
    </style>
}

<div class="p2">
    <h2 class="m1 text-center">Discover</h2>
    <div class="row">

        @{
            var top = (ViewBag.Ontop as DiscoverViewModel);
        }
        @if (top?.Type == DiscoverViewModelType.Blog && top.Blog.IsShow)
        {
            <div class="col-md-8 discove-top">
                <a href="~/blog/details/@top.Blog.Id">
                    <img class="m2" src="@String.Format("/upload/{0}", top.Blog.Cover).ToLower()" />
                </a>
            </div>
            <div class="col-md-4">
                <div class="center n o-des">
                    <p class="green bold m4">BLOG</p>
                    <h4><a href="~/blog/details/@top.Blog.Id">@top.Blog.Title</a></h4>
                    <p class="m6">@top.Blog.Title</p>
                    <p class="m5">
                        @top.Blog.Summary
                    </p>
                </div>
            </div>
        }
        else if (top?.Type == DiscoverViewModelType.Event)
        {
            <div class="col-md-8 discove-top">
                <a href="~/event/details/@top.Event.Id">
                    <img class="m2" src="@String.Format("/upload/{0}", top.Event.Cover).ToLower()" />
                </a>
            </div>
            <div class="col-md-4">
                <div class="center n o-des">
                    <p class="green bold m4">EVENT</p>
                    <h4><a href="~/event/details/@top.Event.Id">@top.Event.Name</a></h4>
                    <p class="m6"> @top.Event.StartTime - @top.Event.EndTime</p>
                    <p> @top.Event.Country, @top.Event.City</p>
                </div>
            </div>
        }
        else if (top?.Type == DiscoverViewModelType.News)
        {
            <div class="col-md-8 discove-top">
                <a href="@top.News.Link" target="_blank">
                    <img class="m2" src="@String.Format("/upload/{0}", top.News.Cover).ToLower()" />
                </a>
            </div>
            <div class="col-md-4">
                <div class="center n o-des">
                    <p class="green bold m4">NEWS</p>
                    <h4><a href="@top.News.Link" target="_blank">@top.News.Title</a></h4>
                    <p class="m6">@top.News.Time</p>
                </div>
            </div>
        }
    </div>
</div>

<form asp-action="Discover" method="get" class="border-bottom dis-search">
    <span>+</span>
    <input name="keywords" type="text" class="search-input" />
    <span>清空</span>
    <select name="type">
        <option value="">All types</option>
        <option value="1">BLOGS</option>
        <option value="2">EVENTS</option>
        <option value="3">NEWS</option>
    </select>
    <select name="year" asp-items="ViewBag.Year"></select>
    <input type="submit" value="search" />
</form>

<div class="row list2 mt5">
    @foreach (var item in Model)
    {
        if (item.Type == DiscoverViewModelType.Blog)
        {
            @if (item.Blog.IsShow || ViewBag.UserRules)
            {
                <div class="col-md-4 discover-item">
                    <a href="~/blog/details/@item.Blog.Id">
                        <img src="@String.Format("/upload/{0}", @item.Blog.Cover).ToLower()" />
                    </a>
                    <div class="small">@item.Time.Month.ToMonth() @item.Time.Day, @item.Time.Year<span class="green ml2">@item.Type</span></div>
                    <div class="list-title"><a href="~/blog/details/@item.Blog.Id">@item.Blog.Title</a></div>
                    <div class="small">
                        @if (!string.IsNullOrEmpty(item.Blog.Tags))
                        {
                            foreach (var tag in item.Blog.Tags.Split(','))
                            {
                                <a href="~/discover?keywords=@tag.Trim()"># @tag.Trim()</a>
                            }
                        }
                    </div>
                    @if (!item.Blog.IsShow && ViewBag.UserRules)
                    {
                        <p>未发布博客，仅管理员可见</p>
                    }
                </div>
            }
        }
        else if (item.Type == DiscoverViewModelType.Event)
        {
            <div class="col-md-4 discove-item">
                <a href="~/event/details/@item.Event.Id">
                    <img src="@String.Format("/upload/{0}", @item.Event.Cover).ToLower()" />
                </a>
                <div class="small">@item.Time.Month.ToMonth() @item.Time.Day, @item.Time.Year<span class="green ml2">@item.Type</span></div>
                <div class="list-title"><a href="~/event/details/@item.Event.Id">@item.Event.Name</a></div>
                <div class="small">@item.Event.Country - @item.Event.City</div>
            </div>
        }
        else if (item.Type == DiscoverViewModelType.News)
        {
            <div class="col-md-4 discove-item">
                <a href="@item.News.Link" target="_blank">
                    <img class="m2" src="@String.Format("/upload/{0}", @item.News.Cover).ToLower()" />
                </a>
                <div class="small">@item.Time.Month.ToMonth() @item.Time.Day, @item.Time.Year<span class="green ml2">@item.Type</span></div>
                <div class="list-title"><a href="@item.News.Link" target="_blank">@item.News.Title</a></div>
                <div class="small">>@item.News.Tags</div>
            </div>
        }
    }
</div>



